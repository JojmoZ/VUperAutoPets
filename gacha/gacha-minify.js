document.addEventListener("DOMContentLoaded",(function(){localStorage.removeItem("ingame");const e=document.getElementById("lever"),t=[document.getElementById("column1"),document.getElementById("column2"),document.getElementById("column3")],n=(document.getElementById("gachaResult"),document.querySelector("h1[data-text='Try Your Luck!']"));let o=[];const s=localStorage.getItem("username");fetch("../assets/jsons/shopAnimals.json").then((e=>e.json())).then((e=>{o=e,t.forEach((e=>l(e))),console.log("shopAnimals loaded:",o)})).catch((e=>console.error("Error loading shopAnimals:",e)));let a=!1;function l(e){const t=document.createElement("div");t.style.position="relative",t.style.top="0px",e.appendChild(t);e.dataset.initialAnimals=JSON.stringify([]);const n=[];for(let e=0;e<21;e++){const e=document.createElement("div");e.classList.add("slot-item");const s=o[Math.floor(Math.random()*o.length)];n.push(s),e.innerHTML=`<img src="${s.img}" alt="${s.name}" style="width 167px; height 167px;">`,t.appendChild(e)}e.dataset.initialAnimals=JSON.stringify(n)}if(!localStorage.getItem("loggedin")){!function(){const e=["users"];Object.keys(localStorage).forEach((t=>{e.includes(t)||localStorage.removeItem(t)}))}(),window.location.href="/login/index.html"}const r=document.getElementById("coinsDisplay");document.getElementById("backArrow").addEventListener("click",(function(){window.location.href="/shop/shoppage.html"}));const i=document.createElement("img");function d(){const e=localStorage.getItem("coins");r.style.fontFamily="VUper",r.style.position="fixed",r.style.top="1.75rem",r.style.right="9.375rem",r.style.color="black",r.style.fontSize="2rem",r.style.zIndex="9999",r.textContent=`Coins: ${e}`;let t=JSON.parse(localStorage.getItem("users"))||[];const n=t.findIndex((e=>e.displayName===s));-1!==n&&(t[n].coins=e,localStorage.setItem("users",JSON.stringify(t)))}i.src="../assets/game-asset/Gold.png",i.style.width="3rem",i.style.height="3rem",i.style.position="fixed",i.style.top="1.5rem",i.style.right="5.5rem",i.style.zIndex="9999",document.body.appendChild(i),d();const m=document.getElementById("gachaSound"),c=document.getElementById("winSound");function u(e,t,n){console.log(t),e.innerHTML="";const s=document.createElement("div");s.style.position="relative",s.style.top="0px",e.appendChild(s);for(let e=0;e<33;e++){const n=document.createElement("div");n.classList.add("slot-item");const a=e===24+Math.floor(1.5)?t:o[Math.floor(Math.random()*o.length)];n.innerHTML=`<img src="${a.img}" alt="${a.name}" style="width: 167px; height: 167px;">`,s.appendChild(n)}const a=-3841;let l=0,r=60;let i=!1;!function e(){if(!i&&Math.abs(l-a)<=200){i=!0;const e=l,t=Date.now();(function o(){const l=Date.now()-t;if(l>=500)s.style.top="-3841px",setTimeout(n,500);else{const t=e+(a-e)*(l/500);s.style.top=`${t}px`,requestAnimationFrame(o)}})()}else l-=r,s.style.top=`${l}px`,l<=-5511&&(l=0),i||(r=Math.max(2,1.01*r)),requestAnimationFrame(e)}()}function h(e){e[0].name===e[1].name&&e[1].name===e[2].name&&(!function(e){let t=JSON.parse(localStorage.getItem("ownedAnimals"))||[];t.some((t=>t.name===e.name))||(t.push(e),localStorage.setItem("ownedAnimals",JSON.stringify(t)))}(e[0]),function(){const e=document.getElementById("fireworks-container"),t=n.innerText;function o(){for(let t=0;t<10;t++){const t=document.createElement("div");t.classList.add("firework"),t.style.backgroundColor=g(),t.style.boxShadow=`0 0 15px 5px ${g()}`,e.appendChild(t),p(t,!0);const n=document.createElement("div");n.classList.add("firework"),n.style.backgroundColor=g(),n.style.boxShadow=`0 0 15px 5px ${g()}`,e.appendChild(n),p(n,!1)}}n.innerText="YOU WIN!",n.setAttribute("data-text","YOU WIN!"),e.style.display="block",o(),setTimeout((()=>{o()}),2e3),setTimeout((()=>{n.classList.add("hover")}),500),setTimeout((()=>{for(e.style.display="none";e.firstChild;)e.removeChild(e.firstChild);n.classList.remove("hover"),n.innerText=t,n.setAttribute("data-text",t)}),5e3)}(),c.play())}function p(e,t){const n=1.5+.5*Math.random(),o=400+300*Math.random(),s=window.innerWidth,a=.3*s,l=.7*s,r=Math.random()*(l-a)+a,i=100*(Math.random()-.5);e.style.position="absolute",e.style.bottom="0px",e.style.left=t?20*Math.random()+"vw":80+20*Math.random()+"vw",setTimeout((()=>{e.style.transition=`all ${n}s ease-out`,e.style.bottom=`${o}px`,e.style.left=`${r+i}px`}),50),setTimeout((()=>{const t=e.getBoundingClientRect();!function(e,t){const n=document.getElementById("fireworks-container");for(let o=0;o<15;o++){const o=document.createElement("div");o.classList.add("firework-particle"),o.style.left=`${e}px`,o.style.top=`${t}px`;const s=100*Math.random()-50,a=100*Math.random()-50;o.style.setProperty("--particle-x",`${s}px`),o.style.setProperty("--particle-y",`${a}px`),o.style.backgroundColor=g(),o.style.boxShadow=`0 0 10px 5px ${g()}`,n.appendChild(o),o.addEventListener("animationend",(()=>{o.parentNode&&o.parentNode.removeChild(o)}))}}(t.left,t.top),e.parentNode&&e.parentNode.removeChild(e)}),1e3*n)}function g(){return`rgb(${Math.floor(256*Math.random())}, ${Math.floor(256*Math.random())}, ${Math.floor(256*Math.random())})`}e.addEventListener("mousedown",(function(){a||(a=!0,e.style.transform="translateY(100px)",m.loop=!0,m.play(),setTimeout((()=>{!function(){const e=parseInt(localStorage.getItem("coins"),10);if(e<5)return void ShowModal("You need at least 5 coins to play the Gacha!");if(localStorage.setItem("coins",e-5),d(),function(){if(cheatAnimal){const e=o.find((e=>e.name===cheatAnimal));if(e){const t=[document.getElementById("column1"),document.getElementById("column2"),document.getElementById("column3")];return t.forEach(((n,o)=>{setTimeout((()=>{u(n,e,(()=>{o===t.length-1&&(a=!1,h([e,e,e]))}))}),1e3*o)})),localStorage.setItem("coins",(localStorage.getItem("coins")-5).toString()),d(),cheatAnimal="",!0}}return!1}())return;const t=[document.getElementById("column1"),document.getElementById("column2"),document.getElementById("column3")],n=[];if(Math.random()<.02){const e=o.filter((e=>["MSeer","VandaJ","YenguiK","PamstIr"].includes(e.name))),t=e[Math.floor(Math.random()*e.length)];for(let e=0;e<3;e++)n.push(t)}else for(let e=0;e<3;e++)n.push(o[Math.floor(Math.random()*o.length)]);t.forEach(((e,o)=>{l(e,n[o]),setTimeout((()=>{u(e,n[o],(()=>{o===t.length-1&&(a=!1,h(n))}))}),1e3*o)}))}()}),500))})),document.addEventListener("mouseup",(function(){e.style.transform="translateY(0)"}));const y=new Audio("../assets/sound/Super Auto Pets  - Menu Theme.mp3");y.volume=.08,y.loop=!0;const f=localStorage.getItem("backgroundAudioTime");f&&(y.currentTime=parseFloat(f));const v=()=>{y.play(),document.removeEventListener("click",v),document.removeEventListener("keydown",v),document.removeEventListener("mousemove",v),document.removeEventListener("scroll",v),document.removeEventListener("touchstart",v),document.removeEventListener("focus",v),document.removeEventListener("mousedown",v),document.removeEventListener("mouseup",v)};document.addEventListener("click",v),document.addEventListener("keydown",v),document.addEventListener("mousemove",v),document.addEventListener("scroll",v),document.addEventListener("touchstart",v),document.addEventListener("focus",v),document.addEventListener("mousedown",v),document.addEventListener("mouseup",v)}));