const captchaModal1=document.getElementById("captchaModal1"),captchaModal2=document.getElementById("captchaModal2"),path=window.electron.path,appDir=window.electron.__dirname;function hideCaptcha(){captchaModal1.classList.add("hide"),captchaModal2.classList.add("hide"),document.body.classList.remove("modal-active"),document.querySelector(".overlay").classList.add("hidden"),setTimeout((()=>{captchaModal1.classList.add("hidden"),captchaModal1.classList.remove("show","hide"),captchaModal2.classList.add("hidden"),captchaModal2.classList.remove("show","hide")}),500)}document.addEventListener("mousemove",(e=>{const{clientX:t,clientY:a}=e,n=2*(t/window.innerWidth-.5),o=2*(a/window.innerHeight-.5),s=document.querySelector(".parallax-layer-1"),r=document.querySelector(".parallax-layer-2"),c=document.querySelector(".parallax-layer-3"),l=document.querySelector(".parallax-layer-4.left"),i=document.querySelector(".parallax-layer-4.right");s.style.transform=`translate(${8*n}px, ${8*o}px)`,r.style.transform=`translate(${18*n}px, ${18*o}px)`,c.style.transform=`translate(${32*n}px, ${32*o}px)`,l.style.transform=`translate(${60*n}px, ${60*o}px) scaleX(-1)`,i.style.transform=`translate(${60*n}px, ${60*o}px)`})),window.onload=function(){localStorage.removeItem("ingame");document.getElementById("captchaChallenge"),document.getElementById("captchaInput");const e=captchaModal1.querySelector(".captcha"),t=captchaModal1.querySelector(".reload-btn"),a=captchaModal2.querySelector(".reload-btn2"),n=captchaModal1.querySelector("#captchaInput1"),o=(captchaModal1.querySelector(".check-btn"),"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".split(""));function s(){e.innerText="";for(let t=0;t<6;t++)e.innerText+=` ${o[Math.floor(Math.random()*o.length)]}`}function r(){n.value=""}t.addEventListener("click",(()=>{r(),s()})),a.addEventListener("click",(()=>{r(),l()}));let c="";function l(){const e=document.getElementById("captchaCanvas"),t=e.getContext("2d");t.clearRect(0,0,e.width,e.height),t.fillStyle="#f0f0f0",t.fillRect(0,0,e.width,e.height);const a="ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";c=Array.from({length:5}).map((()=>a[Math.floor(36*Math.random())])).join(""),t.font="1.875rem Arial",t.fillStyle="#000";for(let e=0;e<c.length;e++){t.save();const a=20+25*e,n=35+10*Math.random();t.translate(a,n),t.rotate(.3*(Math.random()-.5)),t.fillText(c[e],0,0),t.restore()}for(let a=0;a<10;a++)t.strokeStyle="#c0c0c0",t.beginPath(),t.moveTo(Math.random()*e.width,Math.random()*e.height),t.lineTo(Math.random()*e.width,Math.random()*e.height),t.stroke();for(let a=0;a<30;a++)t.fillStyle="#c0c0c0",t.beginPath(),t.arc(Math.random()*e.width,Math.random()*e.height,1,0,2*Math.PI),t.fill()}function i(t){if("captchaModal1"===t){const t=n.value.split("").join(" ");return t===e.innerText?(t.innerHTML="",!0):(x.innerText="Invalid Captcha",A(),!1)}if("captchaModal2"===t){return document.getElementById("captchaInput2").value===c?(hideCaptcha(),!0):(x.innerText="Invalid Captcha",A(),!1)}return!1}const d=document.getElementById("logo"),m=document.getElementById("loginCard"),u=document.getElementById("start-button"),y=document.getElementById("turtle"),p=document.querySelectorAll(".parallax-layer-4");u.addEventListener("click",(()=>{p.forEach((e=>{e.style.transition="transform 1s ease-out, opacity 0.5s ease-out",e.style.transform="translateX(-100vw)",e.style.opacity="0"})),d.style.transition="transform 1s ease-out, opacity 0.5s ease-out",d.style.transform="translateX(-100vw)",d.style.opacity="0",u.style.transition="transform 1s ease-out, opacity 0.5s ease-out",u.style.transform="translateX(-100vw)",u.style.opacity="0",setTimeout((()=>{m.classList.add("centered"),setTimeout((()=>{y.classList.add("pushing")}),540),setTimeout((()=>{y.classList.remove("pushing"),y.style.transform="scaleX(-1)"}),3500),setTimeout((()=>{y.classList.add("offscreen")}),4e3)}),1e3)}));const h=document.getElementById("registerTab"),f=document.getElementById("loginTab"),g=document.getElementById("registrationForm"),v=document.getElementById("loginForm"),w=document.getElementById("registerError"),E=(document.getElementById("loginError"),document.getElementById("errorModal")),x=document.getElementById("modalErrorText");if(localStorage.getItem("loggedin")){const e=path.join(appDir,"home/homepage.html");window.location.href=`file://${e}`}function M(e,t){t.classList.remove("active"),setTimeout((()=>{t.style.display="none",e.style.display="block",setTimeout((()=>{e.classList.add("active")}),20)}),500)}function L(e,t){const a=document.getElementById(`${e}Error`);if(a){a.textContent=t;const n=a.scrollHeight;a.style.height="0",a.style.opacity="0",a.style.transform="translateY(-10px)",a.offsetHeight,a.style.height=`${n}px`,a.style.opacity="1",a.style.transform="translateY(0)",setTimeout((()=>{a.style.height="auto"}),300),setTimeout((()=>{!function(e){const t=document.getElementById(`${e}Error`);if(t){const e=t.scrollHeight;t.style.height=`${e}px`,t.offsetHeight,t.style.height="0",t.style.opacity="0",t.style.transform="translateY(-10px)",setTimeout((()=>{t.style.height="0"}),300)}}(e)}),5e3)}}async function S(e,t,a){const n=await async function(e){try{const t=await fetch("https://trainee-json.vercel.app/trainee.json");return(await t.json()).some((t=>t.TraineeCode===e||t.TraineeName===e))}catch(e){return console.error("Error loading trainee data:",e),!1}}(t);if(n)return x.innerText="User already exists.",void A();hideCaptcha();let o=JSON.parse(localStorage.getItem("users"))||[];if(o.some((e=>e.username===t)))return x.innerText="User already exists.",void A();let s=await I();const r=await crypto.subtle.exportKey("raw",s.cryptoKey);let c=await T(a,s);o.push({displayName:e,username:t,password:{encrypted:Array.from(new Uint8Array(c)),key:Array.from(new Uint8Array(r)),iv:Array.from(s.iv)},coins:15,ownedAnimals:[]}),localStorage.setItem("users",JSON.stringify(o)),g.reset(),w.style.display="none",e!=t&&k(t,a),b(),M(v,g)}async function I(){const e=crypto.getRandomValues(new Uint8Array(12));return{cryptoKey:await crypto.subtle.generateKey({name:"AES-GCM",length:256},!0,["encrypt","decrypt"]),iv:e}}async function T(e,t){const a=(new TextEncoder).encode(e);return await crypto.subtle.encrypt({name:"AES-GCM",iv:t.iv},t.cryptoKey,a)}function b(){const e=document.getElementById("successModal");e&&e.remove(),E.style.bottom="-100px";document.body.insertAdjacentHTML("beforeend",'\n        <div id="successModal">\n            <div class="modal-content">\n                <svg class="checkmark" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 52 52">\n                    <circle class="checkmark-circle" cx="26" cy="26" r="25" fill="none" style="stroke-dasharray: 166; stroke-dashoffset: 166;" />\n                    <path class="checkmark-check" fill="none" d="M14.1 27.2l7.1 7.2 16.7-16.8" style="stroke-dasharray: 48; stroke-dashoffset: 48;" />\n                </svg>\n                <p id="modalSuccessText">Registration Successful!</p>\n            </div>\n        </div>\n    ');const t=document.getElementById("successModal"),a=t.querySelector(".checkmark-circle"),n=t.querySelector(".checkmark-check");t.style.position="fixed",t.style.bottom="-100px",t.style.left="50%",t.style.transform="translateX(-50%)",t.style.backgroundColor="#4CAF50",t.style.color="white",t.style.width="300px",t.style.textAlign="center",t.style.padding="15px",t.style.borderRadius="10px",t.style.boxShadow="0 4px 8px rgba(0, 0, 0, 0.2)",t.style.transition="all 0.5s ease",t.offsetWidth,setTimeout((()=>{t.style.bottom="20px",a.style.transition="stroke-dashoffset 1.5s ease-in-out",n.style.transition="stroke-dashoffset 1s ease-in-out 1.5s",a.style.strokeDashoffset="0",n.style.strokeDashoffset="0"}),10),setTimeout((()=>{t.style.bottom="-100px",setTimeout((()=>t.remove()),500)}),5e3)}h.classList.add("active"),g.classList.add("active"),g.style.display="block",h.addEventListener("click",(()=>{M(g,v)})),f.addEventListener("click",(()=>{M(v,g)})),g.addEventListener("submit",(function(e){e.preventDefault();const t=document.getElementById("registerUsername").value,a=document.getElementById("registerPassword").value,n=document.getElementById("confirmPassword").value;document.querySelectorAll(".error-message").forEach((e=>{e.classList.remove("show")}));const o=["admin","trainer","recsel"];if(""===t||""===a||""===n)return x.innerHTML="Please fill all fields",void A();if(!(e=>e.length>=5&&e.length<=20&&!o.includes(e.toLowerCase()))(t))return void L("username","Username must be between 5-20 characters long");if(!(e=>{const t=/[A-Z]/.test(e),a=/[a-z]/.test(e),n=!/(.)\1{1,}/.test(e);return t&&a&&n})(a))return void L("password","Password must have at least one uppercase, one lowercase letter, no 2 repeated characters in a row, and cannot match the username.");if(a===t)return void L("password","Password Must not be the same as the username");if(a!==n)return void L("confirmPassword","Passwords do not match");const r=function(){const e=Math.random()>.5,t=e?captchaModal1:captchaModal2;return t.classList.remove("hidden"),t.classList.add("show"),document.body.classList.add("modal-active"),document.querySelector(".overlay").classList.remove("hidden"),e?s():l(),e?"captchaModal1":"captchaModal2"}();captchaModal1.querySelector(".check-btn").onclick=()=>{i(r)&&S(t,t,a)},captchaModal2.querySelector("#submitCaptchaBtn2").onclick=()=>{i(r)&&S(t,t,a)}}));async function k(e,t){const a=(JSON.parse(localStorage.getItem("users"))||[]).find((t=>t.username===e));if(!a){try{const a=await fetch("https://trainee-json.vercel.app/trainee.json"),n=(await a.json()).find((a=>a.TraineeCode===e&&a.TraineePassword===t));n&&async function(e,t,a){hideCaptcha();let n=JSON.parse(localStorage.getItem("users"))||[];if(n.some((e=>e.username===t)))return x.innerText="User already exists.",void A();let o=await I();const s=await crypto.subtle.exportKey("raw",o.cryptoKey);let r=await T(a,o);n.push({displayName:e,username:t,password:{encrypted:Array.from(new Uint8Array(r)),key:Array.from(new Uint8Array(s)),iv:Array.from(o.iv)},coins:15,ownedAnimals:[]}),localStorage.setItem("users",JSON.stringify(n)),g.reset(),w.style.display="none",e!=t&&k(t,a),b(),M(v,g)}(n.TraineeName,n.TraineeCode,n.TraineePassword)}catch(e){console.error("Error loading trainee data:",e)}return x.innerText="Invalid username or password.",void A()}const n=new Uint8Array(a.password.key),o=new Uint8Array(a.password.iv),s=await crypto.subtle.importKey("raw",n,{name:"AES-GCM"},!1,["decrypt"]);if(await async function(e,t){const a=await crypto.subtle.decrypt({name:"AES-GCM",iv:t.iv},t.cryptoKey,e);return(new TextDecoder).decode(a)}(new Uint8Array(a.password.encrypted),{cryptoKey:s,iv:o})===t){localStorage.setItem("loggedin",!0),localStorage.setItem("username",a.displayName),localStorage.setItem("coins",a.coins),localStorage.setItem("ownedAnimals",JSON.stringify(a.ownedAnimals));const e=path.join(appDir,"menu/menu.html");window.location.href=`file://${e}`}else x.innerText="Invalid username or password.",A()}function A(){const e=document.getElementById("successModal");e&&(e.style.bottom="-100px",setTimeout((()=>e.remove()),500)),E.style.bottom="20px",setTimeout((()=>{E.style.bottom="-100px"}),3e3)}document.querySelectorAll(".toggle-password").forEach((e=>{const t=document.getElementById(e.dataset.target);e.style.visibility="hidden",t.addEventListener("input",(()=>{t.value?e.style.visibility="visible":e.style.visibility="hidden"})),e.addEventListener("click",(()=>{const a=e.querySelector("img");"password"===t.type?(t.type="text",a.src="../assets/login/hide.png"):(t.type="password",a.src="../assets/login/eye.png")}))})),v.addEventListener("submit",(function(e){e.preventDefault();k(document.getElementById("loginUsername").value,document.getElementById("loginPassword").value)}));const B=new Audio("../assets/sound/Super Auto Pets  - Menu Theme.mp3");B.volume=.08,B.loop=!0;const C=localStorage.getItem("backgroundAudioTime");C&&(B.currentTime=parseFloat(C));const q=()=>{B.play(),document.removeEventListener("click",q),document.removeEventListener("keydown",q),document.removeEventListener("mousemove",q),document.removeEventListener("scroll",q),document.removeEventListener("touchstart",q),document.removeEventListener("focus",q),document.removeEventListener("mousedown",q),document.removeEventListener("mouseup",q)};document.addEventListener("click",q),document.addEventListener("keydown",q),document.addEventListener("mousemove",q),document.addEventListener("scroll",q),document.addEventListener("touchstart",q),document.addEventListener("focus",q),document.addEventListener("mousedown",q),document.addEventListener("mouseup",q)};