document.addEventListener("DOMContentLoaded",(function(){if(!localStorage.getItem("loggedin")){!function(){const e=["users"];Object.keys(localStorage).forEach((t=>{e.includes(t)||localStorage.removeItem(t)}))}(),window.location.href="/login/index.html"}localStorage.removeItem("ingame");const e=["VandaJ","MSeer","eagSVle","PamstIr","YenguiK"];localStorage.getItem("coins")||(localStorage.setItem("coins","15"),localStorage.setItem("ownedAnimals",JSON.stringify([])));const t=localStorage.getItem("username");document.getElementById("redeem-btn").addEventListener("click",(function(){let e=JSON.parse(localStorage.getItem("users"))||[];const n=e.findIndex((e=>e.displayName===t));if(-1!==n){let t=e[n].pendingCoins||0;t>0?(e[n].coins=(e[n].coins||0)+t,e[n].pendingCoins=0,localStorage.setItem("users",JSON.stringify(e)),ShowModal(`You've earned ${t} coins!`)):ShowModal("No coins to redeem!")}else console.error(`User with username "${t}" not found.`)}));document.querySelectorAll(".card");const n=document.getElementById("modal"),o=document.getElementById("modal-animal-image"),a=document.getElementById("confirm-buy"),s=document.getElementById("cancel-buy"),c=document.getElementById("coinsDisplay");document.getElementById("coinImg");document.getElementById("backArrow").addEventListener("click",(function(){window.location="/menu/menu.html"}));const l=document.querySelector(".shop-container"),i=document.getElementById("scroll-bar");Array.from(document.querySelectorAll(".shop-container .card")).forEach(((e,t)=>{const n=t%2+1,o=Math.floor(t/2)+1;e.style.gridRowStart=n,e.style.gridColumnStart=o}));let r,d=!1,m=0;function u(){if(Math.abs(m)>.5){l.scrollLeft+=m,m*=.85;const e=l.scrollWidth-window.innerWidth,t=l.scrollLeft,n=Math.max(0,Math.min(t,e));document.body.style.backgroundPosition=-n+"px top",r=requestAnimationFrame(u)}else cancelAnimationFrame(r),d=!1}l.addEventListener("wheel",(function(e){0===e.deltaY&&0===e.deltaX||(e.preventDefault(),m+=e.deltaY+e.deltaX,d||(d=!0,r=requestAnimationFrame(u)))}),{passive:!1}),l.addEventListener("scroll",(function(){const e=l.scrollWidth-l.clientWidth,t=l.scrollLeft/e*100;i.value=t})),i.addEventListener("input",(function(){const e=l.scrollWidth-l.clientWidth,t=i.value/100*e;l.scrollLeft=t}));let f=[];function g(e){return{"#ff0000":"#ff7f7f","#B7895A":"#d1a48b","#00ff00":"#7fff7f","#0000ff":"#7f7fff","#ffff00":"#ffbf00","#ff00ff":"#ff7fff","#00ffff":"#7fffff","#636363":"#8c8c8c","#0594DB":"#5bb8e6","#AB7B62":"#d1a48b","#FF938F":"#ffb3b0","#6C8C09":"#8fbf0c","#B4BCBF":"#d1d8da","#FF819E":"#ffb3c1","#F09D61":"#f4b98d","#8F999E":"#b3c1c6","#A3735E":"#c49a85","#D6A16F":"#e6c1a0","#EB8760":"#f1a48b","#CF4F4B":"#e67f7c","#99593D":"#b37a5e","#D9A46F":"#e6c1a0","#707070":"#8c8c8c","#676880":"#8c8ca0","#868A91":"#a3a7af","#FADDA9":"#fce6c1","#A4C400":"#c1e600","#8EA848":"#b3d16c","#FFDE59":"#ffe680","#766D78":"#a39aa3","#B4D7E3":"#d1eaf1"}[e]||"#ffffff"}function y(){const e=parseInt(localStorage.getItem("coins"),10);c.textContent=function(e){return e>=1e6?(e/1e6).toFixed(1)+"M":e>=1e3?(e/1e3).toFixed(1)+"K":e.toString()}(e);let n=JSON.parse(localStorage.getItem("users"))||[];const o=n.findIndex((e=>e.displayName===t));-1!==o&&(n[o].coins=e,localStorage.setItem("users",JSON.stringify(n)))}function h(e){const t=[...document.querySelectorAll(".card")].find((t=>t.querySelector("h3").textContent===e));if(t){const e=document.createElement("div");e.classList.add("sold-out"),t.appendChild(e)}}!async function(){try{const t=await fetch("../assets/jsons/shopAnimals.json");if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);f=await t.json(),function(t){const c=document.getElementById("shopContainer");t.forEach((t=>{const l=document.createElement("div");l.classList.add("card"),l.setAttribute("data-animal",t.name),l.setAttribute("data-color",t.color);const i=document.createElement("img");i.src=t.img,i.alt=t.name;const r=document.createElement("h3");r.textContent=t.name,r.style.backgroundImage=`linear-gradient(135deg, ${t.color}, ${g(t.color)})`,r.style.backgroundClip="text",r.style.webkitBackgroundClip="text",r.style.width="100%",r.style.textAlign="center",r.style.color="transparent",r.style.letterSpacing="0.2rem",r.style.webkitTextStroke="0.1rem black",l.appendChild(i),l.appendChild(r);const d=t.color;l.style.setProperty("--animal-color",d),l.classList.add("gradient-hover");const m=document.createElement("div");m.classList.add("sold-out"),JSON.parse(localStorage.getItem("ownedAnimals")).some((e=>e.name===t.name))&&l.appendChild(m),l.addEventListener("click",(function(){const t=this.querySelector("h3").textContent,c=f.find((e=>e.name===t)),l=new Audio(c.sound);l.volume=.2,l.play();const i=this.querySelector("img").src;if(JSON.parse(localStorage.getItem("ownedAnimals")).some((e=>e.name===t)))return void ShowModal("You already own this animal!");const r=document.getElementById("textext");r.innerHTML="Are you sure you want to buy this?",a.style.display="inline-block",r.style.textAlign="center",s.innerHTML="Close",o.src=i,n.setAttribute("data-animal",t),n.setAttribute("data-price",c.cost),document.getElementById("modal-animal-price").textContent=`Price: ${c.cost} Coins`,document.getElementById("modal-animal-stats").textContent=`Attack: ${c.attack}, Health: ${c.health}`;const d=document.querySelector(".modal-content"),m=g(c.color);d.style.background=`linear-gradient(135deg, ${c.color} 0%, ${m} 100%)`;const u=document.querySelector(".image-container"),y=function(e){return{"#ff0000":"#b30000","#00ff00":"#009900","#0000ff":"#000099","#ffff00":"#b3b300","#ff00ff":"#b300b3","#00ffff":"#009999","#636363":"#3f3f3f","#0594DB":"#036ba1","#AB7B62":"#7a5644","#FF938F":"#b36663","#6C8C09":"#4a5e06","#B4BCBF":"#7a8284","#FF819E":"#b35a6e","#F09D61":"#a36d44","#8F999E":"#5f666a","#A3735E":"#704f42","#D6A16F":"#946b4b","#EB8760":"#a35d42","#CF4F4B":"#8f3533","#99593D":"#663d2a","#D9A46F":"#946b4b","#707070":"#4d4d4d","#676880":"#46465a","#868A91":"#5c5f64","#FADDA9":"#b39b73","#A4C400":"#6e8a00","#8EA848":"#5f7230","#FFDE59":"#b3a040","#766D78":"#4f4950","#B4D7E3":"#7a9ba1"}[e]||"#000000"}(c.color);u.style.setProperty("--animal-border-color",y),e.includes(t)&&(r.innerHTML="You cannot buy this animal. You can only get this animal through gacha.",a.style.display="none",r.style.textAlign="center",s.innerHTML="Close"),n.style.display="flex",n.classList.add("show")})),c.appendChild(l)}))}(f)}catch(e){console.error("Error loading shopAnimals:",e)}}(),y();document.getElementById("gacha-btn").addEventListener("click",(function(){window.location="/gacha/gachapage.html"}));(JSON.parse(localStorage.getItem("ownedAnimals"))||[]).forEach((e=>{h(e.name)})),s.addEventListener("click",(function(){n.classList.remove("show"),n.classList.add("hide"),setTimeout((()=>{n.style.display="none",n.classList.remove("hide")}),500)})),a.addEventListener("click",(function(){n.classList.remove("show"),n.classList.add("hide"),setTimeout((()=>{n.style.display="none",n.classList.remove("hide")}),500)})),a.addEventListener("click",(function(){const e=n.getAttribute("data-animal"),o=parseInt(n.getAttribute("data-price"),10);let a=parseInt(localStorage.getItem("coins"),10),s=JSON.parse(localStorage.getItem("ownedAnimals"))||[];if(a>=o){const n=f.find((t=>t.name===e));a-=o,s.push(n),localStorage.setItem("coins",a.toString()),localStorage.setItem("ownedAnimals",JSON.stringify(s));let c=JSON.parse(localStorage.getItem("users"))||[];const l=c.findIndex((e=>e.displayName===t));-1!==l&&(c[l].coins=a,c[l].ownedAnimals=s,localStorage.setItem("users",JSON.stringify(c))),y(),function(){const e=new Audio("../coins-135571.mp3");e.volume=.2,e.play()}(),h(e)}else ShowModal("You don't have enough coins to buy this animal!");n.classList.remove("show"),setTimeout((()=>{n.style.display="none"}),500)}));const E=new Audio("../assets/sound/Super Auto Pets  - Menu Theme.mp3");E.volume=.08,E.loop=!0;const p=localStorage.getItem("backgroundAudioTime");p&&(E.currentTime=parseFloat(p));const S=()=>{E.play(),document.removeEventListener("click",S),document.removeEventListener("keydown",S),document.removeEventListener("mousemove",S),document.removeEventListener("scroll",S),document.removeEventListener("touchstart",S),document.removeEventListener("focus",S),document.removeEventListener("mousedown",S),document.removeEventListener("mouseup",S)};document.addEventListener("click",S),document.addEventListener("keydown",S),document.addEventListener("mousemove",S),document.addEventListener("scroll",S),document.addEventListener("touchstart",S),document.addEventListener("focus",S),document.addEventListener("mousedown",S),document.addEventListener("mouseup",S),window.addEventListener("beforeunload",(()=>{localStorage.setItem("backgroundAudioTime",E.currentTime)}));const v=document.getElementById("search-input");v.addEventListener("input",(function(){const e=v.value.toLowerCase().trim();document.querySelectorAll(".card").forEach((t=>{t.getAttribute("data-animal").toLowerCase().includes(e)?t.style.display="flex":t.style.display="none"}))}));let b="";const A={jaklingko:"500000 Coins",nuclear:"All Animals"};let I=!1,L="";function w(){let e=Number(localStorage.getItem("coins"));e+=5e5,localStorage.setItem("coins",e.toString());let n=JSON.parse(localStorage.getItem("users"))||[];const o=n.findIndex((e=>e.displayName===t));-1!==o&&(n[o].coins=e,localStorage.setItem("users",JSON.stringify(n))),y()}function B(){localStorage.setItem("ownedAnimals",JSON.stringify(f));let e=JSON.parse(localStorage.getItem("users"))||[];const n=e.findIndex((e=>e.displayName===t));-1!==n&&(e[n].ownedAnimals=f,localStorage.setItem("users",JSON.stringify(e))),f.forEach((e=>{h(e.name)}))}document.addEventListener("keydown",(function(e){b+=e.key.toLowerCase(),b.length>10&&(b=b.slice(1));for(const[e,t]of Object.entries(A))if(b.endsWith(e)){I=!0,L=t,"jaklingko"===e?w():"nuclear"===e&&B();break}}));const C=document.getElementById("cheat-modal"),k=document.getElementById("cheat-text"),F=document.getElementById("cheat-reward");document.addEventListener("keydown",(function(e){var t;I&&(t=L,k.textContent="Cheat Activated!",F.textContent=t,C.style.display="flex",setTimeout((()=>{C.classList.add("show")}),10),setTimeout((()=>{C.classList.remove("show"),C.classList.add("hide"),setTimeout((()=>{C.style.display="none",C.classList.remove("hide"),I=!1}),500)}),1500),I=!1)}))}));