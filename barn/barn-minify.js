const animalContainer=document.getElementById("animals"),walkingSpeed=50,frameDuration=1e3/60;localStorage.removeItem("ingame");const gridSize=10;let animationId,scaleX,scaleY,foodElement=null,foodElements=[];const restrictedZones=[{x:0,y:0,width:50,height:1080},{x:0,y:0,width:320,height:230},{x:1850,y:0,width:70,height:1080},{x:910,y:90,width:25,height:130},{x:910,y:170,width:50,height:60},{x:1410,y:0,width:220,height:120},{x:1630,y:60,width:25,height:50},{x:1680,y:0,width:90,height:55},{x:1635,y:160,width:14,height:140},{x:1610,y:280,width:310,height:100},{x:1169,y:280,width:250,height:100},{x:969,y:280,width:120,height:100},{x:949,y:260,width:120,height:100},{x:929,y:240,width:120,height:100},{x:400,y:140,width:120,height:100},{x:420,y:160,width:120,height:100},{x:440,y:180,width:120,height:100},{x:460,y:200,width:120,height:100},{x:890,y:220,width:100,height:100},{x:1635,y:230,width:285,height:50},{x:1169,y:230,width:245,height:50},{x:1394,y:160,width:16,height:100},{x:410,y:0,width:20,height:230},{x:430,y:90,width:30,height:50},{x:795,y:100,width:20,height:90},{x:605,y:0,width:150,height:80},{x:500,y:180,width:330,height:140},{x:0,y:420,width:445,height:35},{x:435,y:420,width:15,height:175},{x:435,y:650,width:15,height:180},{x:0,y:880,width:280,height:90},{x:270,y:850,width:330,height:100},{x:295,y:820,width:150,height:80},{x:270,y:850,width:10,height:80},{x:600,y:820,width:20,height:150},{x:670,y:820,width:20,height:150},{x:690,y:835,width:90,height:120},{x:780,y:835,width:100,height:100},{x:820,y:935,width:15,height:150},{x:1350,y:915,width:570,height:160},{x:800,y:815,width:200,height:60},{x:890,y:780,width:180,height:70},{x:970,y:750,width:100,height:70},{x:990,y:730,width:100,height:70},{x:1010,y:710,width:100,height:70},{x:1040,y:680,width:100,height:60},{x:1065,y:590,width:100,height:120},{x:1065,y:450,width:100,height:120},{x:1040,y:430,width:170,height:75},{x:1060,y:410,width:130,height:130},{x:1085,y:190,width:80,height:300},{x:1110,y:160,width:80,height:100},{x:1130,y:140,width:80,height:100},{x:1130,y:140,width:100,height:30},{x:1160,y:0,width:100,height:20},{x:1160,y:40,width:100,height:100},{x:0,y:1070,width:1920,height:150}];function updateScalingFactors(){const t=document.getElementById("animals").getBoundingClientRect();scaleX=t.width/1920,scaleY=t.height/1080}const logged=localStorage.getItem("loggedin");if(!logged){function clearLocalStorageExceptUsers(){const t=["users"];Object.keys(localStorage).forEach((e=>{t.includes(e)||localStorage.removeItem(e)}))}clearLocalStorageExceptUsers(),window.location.href="/login/index.html"}function isInRestrictedZone(t,e,o,i){return updateScalingFactors(),restrictedZones.some((n=>{const a=n.x*scaleX,s=n.y*scaleY,l=n.width*scaleX,r=n.height*scaleY;return t<a+l&&t+o>a&&e<s+r&&e+i>s}))}const rows=Math.floor(window.innerHeight/10),cols=Math.floor(window.innerWidth/10),grid=Array.from({length:rows},(()=>Array(cols).fill(0)));function getUserAnimals(){const t=localStorage.getItem("ownedAnimals");return t?JSON.parse(t):[]}function createAnimal(t){const e=document.createElement("img");let o,i;e.src=t.img,e.className="animal",e.style.position="absolute",e.dataset.name=t.name,e.dataset.attack=t.attack,e.dataset.health=t.health,e.dataset.cost=t.cost,e.dataset.color=t.color;do{o=Math.random()*(animalContainer.clientWidth-50),i=Math.random()*(animalContainer.clientHeight-60)}while(isInRestrictedZone(o,i,50,50));return e.style.left=`${o}px`,e.style.top=`${i}px`,e.dataset.isMovingToFood="false",e.addEventListener("dragstart",(t=>t.preventDefault())),animalContainer.appendChild(e),roamAnimal(e),e}function astar(t,e){const o=[],i=[];for(o.push(t);o.length>0;){let t=o[0];for(let e=1;e<o.length;e++)(o[e].f<t.f||o[e].f===t.f&&o[e].h<t.h)&&(t=o[e]);if(o.splice(o.indexOf(t),1),i.push(t),t.row===e.row&&t.col===e.col){let e=[],o=t;for(;o;)e.push(o),o=o.parent;return e.reverse()}const n=[[0,1],[1,0],[0,-1],[-1,0],[-1,1],[-1,-1],[1,1],[1,-1]];for(let a of n){const n=t.row+a[0],s=t.col+a[1];if(isValidCell(n,s)){const a={row:n,col:s,g:t.g+1,h:heuristic({row:n,col:s},e),f:0,parent:t};if(a.f=a.g+a.h,i.some((t=>t.row===a.row&&t.col===a.col)))continue;const l=o.find((t=>t.row===a.row&&t.col===a.col));(!l||a.g<l.g)&&o.push(a)}}}return null}function heuristic(t,e){return Math.abs(t.row-e.row)+Math.abs(t.col-e.col)}function isValidCell(t,e){return t>=0&&t<rows&&e>=0&&e<cols&&1!==grid[t][e]}restrictedZones.forEach((t=>{const e=Math.floor(t.x/10),o=Math.floor(t.y/10),i=Math.floor((t.x+t.width)/10),n=Math.floor((t.y+t.height)/10);for(let t=o;t<=n;t++)if(!(t>=rows))for(let o=e;o<=i;o++)o>=cols||(grid[t][o]=1)}));const backbtn=document.getElementById("backArrow");function moveOutOfRestrictedZone(t){let e=null,o=0;if([[0,1],[1,0],[0,-1],[-1,0],[-1,1],[-1,-1],[1,1],[1,-1]].forEach((i=>{const n=10*i[0],a=10*i[1];if(!isInRestrictedZone(parseFloat(t.style.left)+n,parseFloat(t.style.top)+a,t.offsetWidth,t.offsetHeight)){const t=Math.sqrt(n*n+a*a);t>o&&(o=t,e={deltaX:n,deltaY:a})}})),!e)return;const i=parseFloat(t.style.left),n=parseFloat(t.style.top),a=i+e.deltaX,s=n+e.deltaY,l=performance.now();requestAnimationFrame((function e(o){const r=o-l,d=Math.min(r/500,1);t.style.left=`${i+(a-i)*d}px`,t.style.top=`${n+(s-n)*d}px`,d<1&&requestAnimationFrame(e)}))}function roamAnimal(t){if("true"===t.dataset.isMovingToFood)return;const e=4e3*Math.random()+3e3,o=2*Math.random()*Math.PI,i=100*Math.random()+50,n=Math.cos(o)*i,a=Math.sin(o)*i,s=parseFloat(t.style.left)+t.offsetWidth/2,l=parseFloat(t.style.top)+t.offsetHeight/2,r=Math.min(Math.max(s+n,t.offsetWidth/2),animalContainer.clientWidth-t.offsetWidth/2),d=Math.min(Math.max(l+a,t.offsetHeight/2),animalContainer.clientHeight-t.offsetHeight/2);if(isInRestrictedZone(r-t.offsetWidth/2,d-t.offsetHeight/2,t.offsetWidth,t.offsetHeight))return moveOutOfRestrictedZone(t),void setTimeout((()=>roamAnimal(t)),100);const h=e/1e3,c=performance.now();let u;u=requestAnimationFrame((function e(o){if("true"===t.dataset.isMovingToFood)return void cancelAnimationFrame(u);const i=(o-c)/1e3,n=Math.min(i/h,1),a=s+(r-s)*n-t.offsetWidth/2,m=l+(d-l)*n-t.offsetHeight/2;if(isInRestrictedZone(a,m,t.offsetWidth,t.offsetHeight))return moveOutOfRestrictedZone(t),void setTimeout((()=>roamAnimal(t)),100);t.style.left=`${a}px`,t.style.top=`${m}px`,n<1?u=requestAnimationFrame(e):setTimeout((()=>roamAnimal(t)),2e3*Math.random())}))}function createFood(t){const e=t.clientX-10,o=t.clientY-10;if(isInRestrictedZone(e,o,20,20))return;const i=document.createElement("div");i.className="food",i.style.position="absolute",i.style.width="1.75rem",i.style.height="1.75rem",i.style.backgroundImage="url('../assets/items/Pizza.webp')",i.style.backgroundSize="cover",i.style.left=`${e}px`,i.style.top=`${o}px`,animalContainer.appendChild(i),foodElements.push(i);const n=Math.floor(t.clientY/10),a=Math.floor(t.clientX/10),s=document.querySelectorAll(".animal");let l=null,r=1/0;s.forEach((t=>{if("true"===t.dataset.isMovingToFood)return;const e=Math.floor((parseFloat(t.style.top)+t.offsetHeight/2)/10),o=Math.floor((parseFloat(t.style.left)+t.offsetWidth/2)/10),i=Math.abs(e-n)+Math.abs(o-a);i<r&&(r=i,l=t)})),l&&(l.dataset.isMovingToFood="true",cancelAnimationFrame(l.roamAnimationId),setTimeout((()=>{const t=astar({row:Math.floor((parseFloat(l.style.top)+l.offsetHeight/2)/10),col:Math.floor((parseFloat(l.style.left)+l.offsetWidth/2)/10)},{row:n,col:a});t&&followPath(l,t,(()=>{i.remove(),foodElements=foodElements.filter((t=>t!==i)),isInRestrictedZone(parseFloat(l.style.left),parseFloat(l.style.top),l.offsetWidth,l.offsetHeight)&&unstickAnimal(l),l.dataset.isMovingToFood="false",roamAnimal(l)}))}),200))}function followPath(t,e,o){let i=0;!function n(){if(i>=e.length)return void(o&&o());const a=e[i],s=10*a.col+5,l=10*a.row+5,r=parseFloat(t.style.left)+t.offsetWidth/2,d=parseFloat(t.style.top)+t.offsetHeight/2,h=s-r,c=l-d,u=Math.sqrt(h*h+c*c);if(u>.7){const e=h/u*.7,o=c/u*.7;t.style.left=r+e-t.offsetWidth/2+"px",t.style.top=d+o-t.offsetHeight/2+"px",requestAnimationFrame(n)}else t.style.left=s-t.offsetWidth/2+"px",t.style.top=l-t.offsetHeight/2+"px",i++,setTimeout(n,10)}(),setTimeout((()=>{}),500)}function drawRestrictedZones(){document.querySelectorAll(".restricted-area").forEach((t=>t.remove())),restrictedZones.forEach((t=>{const e=document.createElement("div");e.className="restricted-area",e.style.position="absolute",e.style.left=t.x*scaleX+"px",e.style.top=t.y*scaleY+"px",e.style.width=t.width*scaleX+"px",e.style.height=t.height*scaleY+"px",animalContainer.appendChild(e)}))}function updateRestrictedZones(){const t=document.getElementById("animals").getBoundingClientRect(),e=t.width/1920,o=t.height/1080;document.querySelectorAll(".restricted-area").forEach(((t,i)=>{const n=restrictedZones[i];t.style.left=n.x*e+"px",t.style.top=n.y*o+"px",t.style.width=n.width*e+"px",t.style.height=n.height*o+"px"}))}function unstickAnimal(t){const e=parseFloat(t.style.left)+t.offsetWidth/2,o=parseFloat(t.style.top)+t.offsetHeight/2,i=10;let n=[];for(let a=-Math.ceil(10);a<=Math.ceil(10);a++)for(let s=-Math.ceil(10);s<=Math.ceil(10);s++){const l=e+s*i,r=o+a*i;if(!(l<0||l>animalContainer.clientWidth||r<0||r>animalContainer.clientHeight)&&!isInRestrictedZone(l-t.offsetWidth/2,r-t.offsetHeight/2,t.offsetWidth,t.offsetHeight)){restrictedZones.every((t=>{const e=t.x*scaleX,o=t.y*scaleY,i=e+t.width*scaleX/2,n=o+t.height*scaleY/2;return Math.sqrt((l-i)**2+(r-n)**2)>=30}))&&n.push({x:l,y:r})}}let a=null,s=1/0;if(n.forEach((t=>{const i=Math.sqrt((t.x-e)**2+(t.y-o)**2);i<s&&(s=i,a=t)})),a){const i=a.x-t.offsetWidth/2,n=a.y-t.offsetHeight/2,s=500,l=performance.now();requestAnimationFrame((function a(r){const d=r-l,h=Math.min(d/s,1),c=e+(i-e)*h,u=o+(n-o)*h;t.style.left=`${c}px`,t.style.top=`${u}px`,h<1?requestAnimationFrame(a):console.log("Animal successfully moved to a safe location.")}))}else console.warn("No valid nearby location found to unstick the animal.")}function updateAnimalSizes(){const t=document.getElementById("animals").getBoundingClientRect(),e=t.width/1920,o=t.height/1080;document.querySelectorAll(".animal").forEach((t=>{t.style.width=50*e+"px",t.style.height=50*o+"px";const i=parseFloat(t.style.left),n=parseFloat(t.style.top);t.style.left=i*e+"px",t.style.top=n*o+"px"}))}function updateCoordinates(){const t=document.getElementById("animals").getBoundingClientRect(),e=t.width/1920,o=t.height/1080;document.querySelectorAll(".animal").forEach((t=>{const i=parseFloat(t.style.left)/e,n=parseFloat(t.style.top)/o;t.style.left=`${i}px`,t.style.top=`${n}px`}));document.querySelectorAll(".restricted-area").forEach(((t,i)=>{const n=restrictedZones[i];t.style.left=n.x*e+"px",t.style.top=n.y*o+"px",t.style.width=n.width*e+"px",t.style.height=n.height*o+"px"}))}function resetGrid(){updateScalingFactors(),grid.forEach((t=>t.fill(0))),restrictedZones.forEach((t=>{const e=Math.floor(t.x*scaleX/10),o=Math.floor(t.y*scaleY/10),i=Math.floor((t.x+t.width)*scaleX/10),n=Math.floor((t.y+t.height)*scaleY/10);for(let t=o;t<=n;t++)for(let o=e;o<=i;o++)t>=0&&t<rows&&o>=0&&o<cols&&(grid[t][o]=1)}))}backbtn.addEventListener("click",(function(){window.location="/menu/menu.html"})),drawRestrictedZones(),window.addEventListener("resize",(()=>{updateScalingFactors(),resetGrid(),drawRestrictedZones()})),updateScalingFactors(),resetGrid(),drawRestrictedZones(),document.addEventListener("DOMContentLoaded",(()=>{hideStatWindow();getUserAnimals().forEach((t=>{createAnimal(t)})),animalContainer.addEventListener("dblclick",createFood),animalContainer.addEventListener("click",(t=>{if(t.target.classList.contains("animal")){showStatWindow(t.target)}else hideStatWindow()}))}));let currentAnimal=null;function showStatWindow(t){document.getElementById("animalStatPicture").src=t.src;const e=document.getElementById("statWindow"),o=document.getElementById("animalName"),i=document.getElementById("animalAttack"),n=document.getElementById("animalHealth"),a=document.getElementById("animalCost"),s=e.querySelector("hr");if(currentAnimal===t)return;currentAnimal=t;const l=t.dataset.color||"#ffffff";e.style.setProperty("--animal-color",l),e.classList.contains("show")?(e.classList.remove("show"),setTimeout((()=>{o.textContent=t.dataset.name,i.textContent=t.dataset.attack,n.textContent=t.dataset.health,a.textContent=t.dataset.cost,s.style.width="0",e.classList.add("show"),setTimeout((()=>{s.style.width="100%"}),10)}),300)):(o.textContent=t.dataset.name,i.textContent=t.dataset.attack,n.textContent=t.dataset.health,a.textContent=t.dataset.cost,s.style.width="0",e.style.display="block",setTimeout((()=>{e.classList.add("show"),setTimeout((()=>{s.style.width="100%"}),10)}),10))}function hideStatWindow(){const t=document.getElementById("statWindow");t.classList.remove("show"),setTimeout((()=>{t.style.display="none",currentAnimal=null}),300)}const backgroundAudio=new Audio("../assets/sound/Super Auto Pets  - Menu Theme.mp3");backgroundAudio.volume=.08,backgroundAudio.loop=!0;const savedTime=localStorage.getItem("backgroundAudioTime");savedTime&&(backgroundAudio.currentTime=parseFloat(savedTime));const playBackgroundAudio=()=>{backgroundAudio.play(),document.removeEventListener("click",playBackgroundAudio),document.removeEventListener("keydown",playBackgroundAudio),document.removeEventListener("mousemove",playBackgroundAudio),document.removeEventListener("scroll",playBackgroundAudio),document.removeEventListener("touchstart",playBackgroundAudio),document.removeEventListener("focus",playBackgroundAudio),document.removeEventListener("mousedown",playBackgroundAudio),document.removeEventListener("mouseup",playBackgroundAudio)};document.addEventListener("click",playBackgroundAudio),document.addEventListener("keydown",playBackgroundAudio),document.addEventListener("mousemove",playBackgroundAudio),document.addEventListener("scroll",playBackgroundAudio),document.addEventListener("touchstart",playBackgroundAudio),document.addEventListener("focus",playBackgroundAudio),document.addEventListener("mousedown",playBackgroundAudio),document.addEventListener("mouseup",playBackgroundAudio);